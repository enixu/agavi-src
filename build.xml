<?xml version="1.0"?>

<project name="agavi" basedir="." default="main">

  <!-- fileset for -dist files -->
  <fileset dir="." id="distfiles">
		<include name="**/*-dist"/>
  </fileset>

  <!-- main target -->
	<target name="main" description="main target">
		<echo msg="available targets: " /> 
		<echo msg="  module     - create a module" />
		<echo msg="  action     - create an action" />
	</target>

	<!-- test target -->
	<target name="test" description="run unit tests">
		<phpunit2>
			<formatter type="xml" todir="reports"/>
			<batchtest>
				<fileset dir="tests">
					<include name="**/*Test*.php"/>
					<exclude name="**/sandbox/**"/>
				</fileset>
			</batchtest>
		</phpunit2>
		<phpunit2report infile="reports/testsuites.xml" format="frames" todir="reports/tests" styledir="etc"/>
		<echo msg="PHPUnit2 test reports have been built in reports/tests."/>
	</target>

	<target name="module" description="create a new module">
		<input propertyname="module" promptChar="?" message="Module Name"/>
		<property name="prefix" value="modules/${module}/"/>
		<mkdir dir="${prefix}"/>
		<mkdir dir="${prefix}actions"/>
		<mkdir dir="${prefix}config"/>
		<mkdir dir="${prefix}models"/>
		<mkdir dir="${prefix}templates"/>
		<mkdir dir="${prefix}views"/>
		<input propertyname="actions" promptChar="?" defaultValue="Index" message="Actions for ${module} (no whitespace, comma seperated)"/>
		<foreach list="${actions}" param="action" target="buildaction"/>
	</target>

	<target name="action" description="create a new action">
		<php expression="basename('${project.basedir}')" returnProperty="module"/>
		<input propertyname="action" promptChar="?" defaultValue="Index" message="Action Name"/>
		<property name="prefix" value=""/>
		<phingcall target="buildaction"/>
	</target>

	<target name="buildaction">
		<touch file="${prefix}actions/${action}Action.class.php"/>
		<input propertyname="views" promptChar="?" defaultValue="Success" message="Views for ${action} (no whitespace, comma seperated)"/>
		<foreach list="${views}" param="view" target="buildview"/>
	</target>

	<target name="buildview">
		<touch file="${prefix}views/${action}${view}View.class.php"/>
	</target>

</project>
